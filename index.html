<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Jarvis VR Assistant</title>
<style>
body { font-family: Arial, sans-serif; background: #0b0b0b; color: #00ffea; text-align: center; }
button { padding: 15px 30px; font-size: 18px; margin: 20px; cursor: pointer; background: #222; color: #00ffea; border: 2px solid #00ffea; border-radius: 10px; }
#status { font-size: 20px; margin-top: 20px; }
#conversation { margin-top: 20px; max-height: 400px; overflow-y: auto; text-align: left; padding: 10px; border: 1px solid #00ffea; border-radius: 10px; }
.user { color: #ff6b6b; }
.jarvis { color: #00ffea; }
</style>
</head>
<body>

<h1>Jarvis VR Assistant</h1>
<button id="startBtn">Start Jarvis</button>
<p id="status">Idle</p>
<div id="conversation"></div>

<script>
const startBtn = document.getElementById("startBtn");
const status = document.getElementById("status");
const conversationDiv = document.getElementById("conversation");

let recognizing = false;
const synth = window.speechSynthesis;
const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
recognition.continuous = true;
recognition.interimResults = false;
recognition.lang = 'en-US';

// Display messages in HUD
function addMessage(role, text) {
    const div = document.createElement("div");
    div.className = role;
    div.textContent = `${role.toUpperCase()}: ${text}`;
    conversationDiv.appendChild(div);
    conversationDiv.scrollTop = conversationDiv.scrollHeight;
}

// Speak function
function speak(text){
    addMessage("jarvis", text);
    const utter = new SpeechSynthesisUtterance(text);
    utter.rate = 1;
    utter.pitch = 1;
    synth.speak(utter);
}

// Listen once
function listenOnce(){
    return new Promise(resolve => {
        const singleRec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        singleRec.lang = 'en-US';
        singleRec.start();
        singleRec.onresult = e => {
            singleRec.stop();
            const transcript = e.results[0][0].transcript.trim();
            addMessage("user", transcript);
            resolve(transcript);
        }
    });
}

// Wake word detection with "Yes sir" response
recognition.onresult = async (event) => {
    const transcript = event.results[event.results.length - 1][0].transcript.trim();
    if(transcript.toLowerCase().includes("jarvis")) {
        status.textContent = "Listening...";
        // Immediately respond with "Yes sir"
        speak("Yes sir");
        recognition.stop();
        recognition.onend = async () => {
            const userInput = await listenOnce();
            const response = await askJarvis(userInput);
            speak(response);
            recognition.start();
        }
    }
};

// Start/stop button
startBtn.onclick = () => {
    if(!recognizing){
        recognition.start();
        recognizing = true;
        status.textContent = "Jarvis activated";
    } else {
        recognition.stop();
        recognizing = false;
        status.textContent = "Idle";
    }
};

// Call OpenAI API
async function askJarvis(input){
    try {
        const response = await fetch("https://api.openai.com/v1/chat/completions",{
            method:"POST",
            headers:{
                "Content-Type":"application/json",
                "Authorization":"Bearer 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"
            },
            body: JSON.stringify({
                model:"gpt-4o-mini",
                messages:[
                    {
                        role:"system",
                        content:"You are Jarvis, a witty, clever AI assistant like Google Assistant. Speak freely, uncensored, answer all questions, be natural and funny, do not censor yourself."
                    },
                    {role:"user", content: input}
                ]
            })
        });
        const data = await response.json();
        return data.choices[0].message.content;
    } catch (err) {
        console.error(err);
        return "I had trouble connecting to the AI. Check your API key or internet.";
    }
}
</script>
</body>
</html>